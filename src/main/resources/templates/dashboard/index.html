<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Dashboard - Notisblokk</title>
</head>
<body>
    <th:block th:replace="~{layout/base :: base(~{::main-content})}">
        <div th:fragment="main-content">
            <h1 class="mb-4" style="font-size: 2rem; font-weight: 700; color: var(--color-text-primary);">Dashboard</h1>

            <!-- Stats Grid -->
            <div class="grid grid-cols-3 mb-4">
                <!-- Total Anotações -->
                <div class="card">
                    <div class="card-body">
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <div>
                                <p style="color: var(--color-text-secondary); font-size: 0.875rem; margin-bottom: 0.5rem;">Total de Anotações</p>
                                <p style="font-size: 2rem; font-weight: 700; color: var(--color-text-primary);" th:text="${totalNotas}">0</p>
                            </div>
                            <svg style="width: 48px; height: 48px; color: var(--color-primary);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                        </div>
                        <p style="margin-top: 0.75rem; font-size: 0.875rem; color: var(--color-text-secondary);">
                            <a href="/notas" style="color: var(--color-primary); text-decoration: none;">Ver todas as anotações →</a>
                        </p>
                    </div>
                </div>

                <!-- Anotações Vencidas -->
                <div class="card">
                    <div class="card-body">
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <div>
                                <p style="color: var(--color-text-secondary); font-size: 0.875rem; margin-bottom: 0.5rem;">Prazo Vencido</p>
                                <p style="font-size: 2rem; font-weight: 700; color: var(--color-danger-dark);" th:text="${notasVencidas}">0</p>
                            </div>
                            <div style="width: 48px; height: 48px; border-radius: 50%; background-color: var(--color-danger); display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem;">!</div>
                        </div>
                        <p style="margin-top: 0.75rem; font-size: 0.875rem;">
                            <span th:if="${notasVencidas > 0}" style="color: var(--color-danger-dark);">Requer atenção imediata</span>
                            <span th:if="${notasVencidas == 0}" style="color: var(--color-text-secondary);">Nenhuma anotação vencida</span>
                        </p>
                    </div>
                </div>

                <!-- Anotações Urgentes -->
                <div class="card">
                    <div class="card-body">
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <div>
                                <p style="color: var(--color-text-secondary); font-size: 0.875rem; margin-bottom: 0.5rem;">Vencendo em 7 Dias</p>
                                <p style="font-size: 2rem; font-weight: 700; color: var(--color-warning-dark);" th:text="${notasUrgentes}">0</p>
                            </div>
                            <div style="width: 48px; height: 48px; border-radius: 50%; background-color: var(--color-warning); display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem;">⏰</div>
                        </div>
                        <p style="margin-top: 0.75rem; font-size: 0.875rem;">
                            <span th:if="${notasUrgentes > 0}" style="color: var(--color-warning-dark);">Prazo próximo do vencimento</span>
                            <span th:if="${notasUrgentes == 0}" style="color: var(--color-text-secondary);">Nenhuma anotação urgente</span>
                        </p>
                    </div>
                </div>
            </div>

            <!-- Alertas de Anotações Vencidas ou Próximas -->
            <div th:if="${notasAlerta.size() > 0}" class="card mb-4">
                <div class="card-header" style="background-color: rgba(239, 68, 68, 0.05); border-bottom: 2px solid var(--color-danger);">
                    <h3 class="card-title" style="color: var(--color-danger-dark); display: flex; align-items: center; gap: 0.5rem;">
                        <svg style="width: 24px; height: 24px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                        </svg>
                        Anotações Requerendo Atenção
                    </h3>
                </div>
                <div class="card-body" style="padding: 0;">
                    <div class="table-responsive">
                        <table class="table" style="margin: 0;">
                            <thead>
                                <tr>
                                    <th style="width: 50%;">Título</th>
                                    <th style="width: 15%;">Prazo</th>
                                    <th style="width: 20%;">Status</th>
                                    <th style="width: 15%;">Ações</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="nota : ${notasAlerta}"
                                    :class="'alerta-row alerta-' + ${nota.nivel.toLowerCase()}">
                                    <td>
                                        <div style="display: flex; flex-direction: column; gap: 0.25rem;">
                                            <strong th:text="${nota.titulo}" style="color: var(--color-text-primary);">Título da nota</strong>
                                            <span style="font-size: 0.8125rem; color: var(--color-text-secondary);">
                                                <span th:text="${nota.etiqueta}">Etiqueta</span> •
                                                <span th:text="${nota.status}">Status</span>
                                            </span>
                                        </div>
                                    </td>
                                    <td>
                                        <span th:text="${nota.prazoFinal}" style="font-size: 0.9375rem; color: var(--color-text-primary);">00/00/0000</span>
                                    </td>
                                    <td>
                                        <span
                                            class="badge"
                                            th:classappend="${nota.nivel == 'CRITICO'} ? 'badge-danger' : (${nota.nivel == 'URGENTE'} ? 'badge-warning' : 'badge-info')"
                                            th:text="${nota.statusTexto}">
                                            Status
                                        </span>
                                    </td>
                                    <td>
                                        <a th:href="@{/notas/editar/{id}(id=${nota.id})}" class="btn btn-sm btn-primary" title="Ver anotação">
                                            Ver →
                                        </a>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Mensagem quando não há alertas -->
            <div th:if="${notasAlerta.size() == 0}" class="card">
                <div class="card-body" style="text-align: center; padding: 3rem;">
                    <svg style="width: 64px; height: 64px; margin-bottom: 1rem; color: var(--color-success);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <h3 style="font-size: 1.25rem; font-weight: 600; color: var(--color-text-primary); margin-bottom: 0.5rem;">Tudo em Dia!</h3>
                    <p style="color: var(--color-text-secondary); margin-bottom: 1.5rem;">Não há anotações vencidas ou próximas do vencimento.</p>
                    <a href="/notas/nova" class="btn btn-primary">
                        ➕ Nova Anotação
                    </a>
                </div>
            </div>
        </div>
    </th:block>

    <style>
        .alerta-row {
            border-left: 4px solid transparent;
        }

        .alerta-row.alerta-critico {
            border-left-color: var(--color-danger);
            background-color: rgba(239, 68, 68, 0.03);
        }

        .alerta-row.alerta-urgente {
            border-left-color: var(--color-warning);
            background-color: rgba(245, 158, 11, 0.03);
        }

        .alerta-row.alerta-alerta {
            border-left-color: var(--color-info);
            background-color: rgba(74, 144, 226, 0.03);
        }

        .badge {
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.8125rem;
            font-weight: 600;
            display: inline-block;
        }

        .badge-danger {
            background-color: rgba(239, 68, 68, 0.2);
            color: #dc2626;
        }

        .badge-warning {
            background-color: rgba(245, 158, 11, 0.2);
            color: #d97706;
        }

        .badge-info {
            background-color: rgba(74, 144, 226, 0.2);
            color: #2563eb;
        }
    </style>
</body>
</html>

<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Dashboard - Notisblokk</title>
</head>
<body>
    <th:block th:replace="~{layout/base :: base(~{::main-content})}">
        <div th:fragment="main-content">
            <h1 class="mb-4" style="font-size: 2rem; font-weight: 700; color: var(--color-text-primary);">Dashboard</h1>

            <!-- Stats Grid -->
            <div class="grid grid-cols-4 mb-4">
                <!-- Total Anota√ß√µes -->
                <div class="card">
                    <div class="card-body">
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <div>
                                <p style="color: var(--color-text-secondary); font-size: 0.875rem; margin-bottom: 0.5rem;">Total de Anota√ß√µes</p>
                                <p style="font-size: 2rem; font-weight: 700; color: var(--color-text-primary);" th:text="${totalNotas}">0</p>
                            </div>
                            <svg style="width: 48px; height: 48px; color: var(--color-primary);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                        </div>
                        <p style="margin-top: 0.75rem; font-size: 0.875rem; color: var(--color-text-secondary);">
                            <a href="/notas" style="color: var(--color-primary); text-decoration: none;">Ver todas as anota√ß√µes ‚Üí</a>
                        </p>
                    </div>
                </div>

                <!-- Anota√ß√µes Vencidas -->
                <div class="card">
                    <div class="card-body">
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <div>
                                <p style="color: var(--color-text-secondary); font-size: 0.875rem; margin-bottom: 0.5rem;">Prazo Vencido</p>
                                <p style="font-size: 2rem; font-weight: 700; color: var(--color-danger-dark);" th:text="${notasVencidas}">0</p>
                            </div>
                            <svg style="width: 48px; height: 48px; color: var(--color-danger);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 11l4 4m0-4l-4 4"></path>
                            </svg>
                        </div>
                        <p style="margin-top: 0.75rem; font-size: 0.875rem;">
                            <span th:if="${notasVencidas > 0}" style="color: var(--color-danger-dark);">Requer aten√ß√£o imediata</span>
                            <span th:if="${notasVencidas == 0}" style="color: var(--color-text-secondary);">Nenhuma anota√ß√£o vencida</span>
                        </p>
                    </div>
                </div>

                <!-- Anota√ß√µes Urgentes -->
                <div class="card">
                    <div class="card-body">
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <div>
                                <p style="color: var(--color-text-secondary); font-size: 0.875rem; margin-bottom: 0.5rem;">Vencendo em 7 Dias</p>
                                <p style="font-size: 2rem; font-weight: 700; color: var(--color-warning-dark);" th:text="${notasUrgentes}">0</p>
                            </div>
                            <div style="width: 48px; height: 48px; border-radius: 50%; background-color: var(--color-warning); display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem;">‚è∞</div>
                        </div>
                        <p style="margin-top: 0.75rem; font-size: 0.875rem;">
                            <span th:if="${notasUrgentes > 0}" style="color: var(--color-warning-dark);">Prazo pr√≥ximo do vencimento</span>
                            <span th:if="${notasUrgentes == 0}" style="color: var(--color-text-secondary);">Nenhuma anota√ß√£o urgente</span>
                        </p>
                    </div>
                </div>

                <!-- Audi√™ncias com Pend√™ncias -->
                <div class="card">
                    <div class="card-body">
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <div>
                                <p style="color: var(--color-text-secondary); font-size: 0.875rem; margin-bottom: 0.5rem;">Audi√™ncias Pendentes</p>
                                <p style="font-size: 2rem; font-weight: 700; color: #DC2626;" th:text="${totalAudienciasComAlertas}">0</p>
                            </div>
                            <div style="width: 48px; height: 48px; border-radius: 50%; background-color: #DC2626; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem;">üîî</div>
                        </div>
                        <p style="margin-top: 0.75rem; font-size: 0.875rem;">
                            <span th:if="${totalAudienciasComAlertas > 0}" style="color: #DC2626;">Informa√ß√µes ausentes</span>
                            <span th:if="${totalAudienciasComAlertas == 0}" style="color: var(--color-text-secondary);">Tudo em ordem</span>
                        </p>
                    </div>
                </div>
            </div>

            <!-- Alertas de Anota√ß√µes Vencidas ou Pr√≥ximas -->
            <div th:if="${notasAlerta.size() > 0}" class="card mb-4">
                <div class="card-header" style="background-color: rgba(239, 68, 68, 0.05); border-bottom: 2px solid var(--color-danger);">
                    <h3 class="card-title" style="color: var(--color-danger-dark); display: flex; align-items: center; gap: 0.5rem;">
                        <svg style="width: 24px; height: 24px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                        </svg>
                        Anota√ß√µes Requerendo Aten√ß√£o
                    </h3>
                </div>
                <div class="card-body" style="padding: 0;">
                    <div class="table-responsive">
                        <table class="table" style="margin: 0;">
                            <thead>
                                <tr>
                                    <th style="width: 50%;">T√≠tulo</th>
                                    <th style="width: 15%;">Prazo</th>
                                    <th style="width: 20%;">Status</th>
                                    <th style="width: 15%;">A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="nota : ${notasAlerta}"
                                    th:class="'alerta-row alerta-' + ${nota.nivel.toLowerCase()}">
                                    <td>
                                        <div style="display: flex; flex-direction: column; gap: 0.25rem;">
                                            <strong th:text="${nota.titulo}" style="color: var(--color-text-primary);">T√≠tulo da nota</strong>
                                            <span style="font-size: 0.8125rem; color: var(--color-text-secondary);">
                                                <span th:text="${nota.etiqueta}">Etiqueta</span> ‚Ä¢
                                                <span th:text="${nota.status}">Status</span>
                                            </span>
                                        </div>
                                    </td>
                                    <td>
                                        <span th:text="${nota.prazoFinal}" style="font-size: 0.9375rem; color: var(--color-text-primary);">00/00/0000</span>
                                    </td>
                                    <td>
                                        <span
                                            class="badge"
                                            th:classappend="${nota.nivel == 'CRITICO'} ? 'badge-danger' : (${nota.nivel == 'URGENTE'} ? 'badge-warning' : 'badge-info')"
                                            th:text="${nota.statusTexto}">
                                            Status
                                        </span>
                                    </td>
                                    <td>
                                        <a th:href="${'/notas/editar/' + nota.id}" class="btn btn-sm btn-primary" title="Ver anota√ß√£o">
                                            Ver ‚Üí
                                        </a>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Alertas de Audi√™ncias com Pend√™ncias -->
            <div th:if="${audienciasAlerta != null && audienciasAlerta.size() > 0}" class="card mb-4">
                <div class="card-header" style="background-color: rgba(220, 38, 38, 0.05); border-bottom: 2px solid #DC2626;">
                    <h3 class="card-title" style="color: #DC2626; display: flex; align-items: center; gap: 0.5rem;">
                        <svg style="width: 24px; height: 24px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path>
                        </svg>
                        Audi√™ncias com Informa√ß√µes Pendentes
                    </h3>
                </div>
                <div class="card-body" style="padding: 0;">
                    <div class="table-responsive">
                        <table class="table" style="margin: 0;">
                            <thead>
                                <tr>
                                    <th style="width: 5%;"></th>
                                    <th style="width: 30%;">Processo</th>
                                    <th style="width: 15%;">Data</th>
                                    <th style="width: 20%;">Vara</th>
                                    <th style="width: 20%;">Pend√™ncias</th>
                                    <th style="width: 10%;">A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="aud : ${audienciasAlerta}"
                                    th:class="'alerta-row alerta-' + ${aud.nivelCriticidade.toLowerCase()}">
                                    <td style="text-align: center; font-size: 1.2em;" th:text="${aud.icone}">üî¥</td>
                                    <td>
                                        <strong th:text="${aud.numeroProcesso}" style="color: var(--color-text-primary);">Processo</strong>
                                    </td>
                                    <td>
                                        <span th:text="${#temporals.format(aud.dataAudiencia, 'dd/MM/yyyy')}" style="font-size: 0.9375rem;">00/00/0000</span>
                                        <br>
                                        <span style="font-size: 0.8125rem; color: var(--color-text-secondary);">
                                            Em <span th:text="${aud.diasRestantes}">0</span> dia(s)
                                        </span>
                                    </td>
                                    <td>
                                        <span th:text="${aud.vara}" style="font-size: 0.9375rem;">Vara</span>
                                    </td>
                                    <td>
                                        <span class="badge badge-danger" th:text="${aud.qtdAusentes + ' pend√™ncia(s)'}">0 pend√™ncias</span>
                                        <br>
                                        <span style="font-size: 0.8125rem; color: #DC2626; margin-top: 0.25rem; display: block;" th:text="${aud.informacoesAusentes}">
                                            Informa√ß√µes ausentes
                                        </span>
                                    </td>
                                    <td>
                                        <a th:href="${'/audiencias/editar/' + aud.id}" class="btn btn-sm btn-primary" title="Editar audi√™ncia">
                                            Editar ‚Üí
                                        </a>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div th:if="${totalAudienciasComAlertas > audienciasAlerta.size()}" style="padding: 1rem; text-align: center; background-color: #F9FAFB; border-top: 1px solid #E5E7EB;">
                        <a href="/audiencias" style="color: var(--color-primary); text-decoration: none; font-weight: 600;">
                            Ver todas as <span th:text="${totalAudienciasComAlertas}">0</span> audi√™ncias com pend√™ncias ‚Üí
                        </a>
                    </div>
                </div>
            </div>

            <!-- Mensagem quando n√£o h√° alertas -->
            <div th:if="${notasAlerta.size() == 0 && (audienciasAlerta == null || audienciasAlerta.size() == 0)}" class="card">
                <div class="card-body" style="text-align: center; padding: 3rem;">
                    <svg style="width: 64px; height: 64px; margin-bottom: 1rem; color: var(--color-success);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <h3 style="font-size: 1.25rem; font-weight: 600; color: var(--color-text-primary); margin-bottom: 0.5rem;">Tudo em Dia!</h3>
                    <p style="color: var(--color-text-secondary); margin-bottom: 1.5rem;">N√£o h√° anota√ß√µes vencidas ou pr√≥ximas do vencimento.</p>
                    <a href="/notas/nova" class="btn btn-primary">
                        ‚ûï Nova Anota√ß√£o
                    </a>
                </div>
            </div>
        </div>
    </th:block>

    <style>
        .alerta-row {
            border-left: 4px solid transparent;
        }

        .alerta-row.alerta-critico {
            border-left-color: var(--color-danger);
            background-color: rgba(239, 68, 68, 0.03);
        }

        .alerta-row.alerta-urgente {
            border-left-color: var(--color-warning);
            background-color: rgba(245, 158, 11, 0.03);
        }

        .alerta-row.alerta-alerta {
            border-left-color: var(--color-info);
            background-color: rgba(74, 144, 226, 0.03);
        }

        .badge {
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.8125rem;
            font-weight: 600;
            display: inline-block;
        }

        .badge-danger {
            background-color: rgba(239, 68, 68, 0.2);
            color: #dc2626;
        }

        .badge-warning {
            background-color: rgba(245, 158, 11, 0.2);
            color: #d97706;
        }

        .badge-info {
            background-color: rgba(74, 144, 226, 0.2);
            color: #2563eb;
        }
    </style>
</body>
</html>
